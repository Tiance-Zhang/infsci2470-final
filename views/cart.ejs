<!DOCTYPE html>
<html lang="en">
  
<head>
    <meta charset="UTF-8">
    <title>Cart</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
</head>
<link rel="stylesheet" href="/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<body>


    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">

            <h2 style="color:white;">&nbsp;&nbsp;Checklist&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
   <span class="navbar-toggler-icon"></span>
  </button>

            <div class="collapse navbar-collapse" id="navbarResponsive">
                <!--     <ul class="navbar-nav mr-auto">
      <li class="nav-item"><a class="nav-link" href="/index">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="/product">Check All Shoes</a></li>
      <li class="nav-item"><a class="nav-link" href="/vendors">Check All Brands</a></li>
    </ul> -->

                <ul class="navbar-nav ml-auto">
                    <!--          <li class="nav-item"><a class="nav-link active" href="/myCart">My Cart</a ></li> -->
                    <li class="nav-item"><a class="nav-link" href="/mine">My Profile</a ></li>
                  <li class="nav-item"><a class="nav-link" href="/instructions">Instruction</a></li>
          <li class="nav-item"><a class="nav-link" href="/dashboard">Log out</a></li>
                  
                </ul>
            </div>
        </nav>
    </div>
<!--     <br/><br/><br/><br/> -->

  
<!--  <div id="SurgicalSkills" class="classification">
   Surgical Skills/procedures
  </div>
  <div id="ClinicalSkills" class="classification">
   Clinical skills:Floor Patient Management
  </div>
  <div id="SurgicalCases" class="classification">
   Surgical Cases
  </div>
  <div id="PatientCare" class="classification">
   Patient care
  </div>
  <div id="Presentations" class="classification">
   Presentations
  </div>
  <div id="IntraoperativeSkills" class="classification">
   Intraoperative Skills
  </div>
  <div id="Orders" class="classification">
   Orders
  </div>
  <div id="SurgicalDiseases" class="classification">
   Surgical diseases
  </div>
  <div id="Imaging" class="classification">
  Imaging:ww.learningradiology.com or Stentor
  </div> -->

    <% if (list) { %>
        <!--   <p style="text-align:center;">There are <%= list.length %> products in the Cart.</p>
   <div class="row justify-content-center">
     <div class ="row">
       <div class="col-lg-8 col-md-7 col-sm-12 col-xs-12"> -->
        <div class="table-responsive">

            
                <% list.forEach(function(product){ %>
          <table class="checklist_table" id="checklist_table">
                    <tr name="list_id">
<!--                         <td class="list_id_button">id:
                            <%= product.Task_id %>
                        </td> -->
                      <td class="list_id_button">
                            <%= product.TaskName %>
                        </td>
                        <td rowspan="6" class="table_button">
                            <!--         <form action="/updateCart?id=<%= product.id %>" method="POST"> -->       
                            <form class="table_form" method="POST" action="/update?_method=PUT&Task_id=<%= product.Task_id %>" target="test">
<!--                             <form class="table_form" method="POST" action="/update?id=<%= product.id %>" > -->
                             
                                <button type="submit" class="change_status" onclick="successAlert()" style="width:100%">Change status</button>
                                  
                            </form>
                        </td>
                    </tr>
                    <tr>
                        <td>Abstract:
                            <%= product.Abstract %>
                        </td>
                    </tr>
                    <tr>
                        <td class="status"><%= product.status %></td>
                    </tr>
                    <tr>
                        <td>Room:
                            <%= product.Room %>
                        </td>
                    </tr>
                    <tr>
                        <td name="description"><%= product.Description %></td>
                    </tr>
 </table>
                    <% }); %>
           
        </div>

        <!--         </div><div class="col-lg-auto col-md-auto col-sm-10 col-xs-10">
      <div class="table-responsive text-center">
          <table class="table table-bordered" style="max-width:95%;">
      <tr><td ><h2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Summary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2></td></tr>
      <tr><td>Total Price: <%= total_price %></td></tr>
      <tr><td align="center"><form action="/clearCart" method="POST">
         <button class="btn btn-secondary btn-lg btn-block" type="submit">
           Clear Cart
         </button>
    </form></td></tr>
    </table> </div></div> 
     </div></div>-->
        <% } else { %>
            <p>No tasks.</p>
            <% } %>


<iframe name="test"></iframe>


                <!--   <br/><br/><br/><br/> -->

                <!--   <footer class="container-fluid bg-dark">
<p class="m-0 text-center text-white">Copyright &copy; Venom 2020</p>
</footer> -->

                <script>
                  function successAlert(){
                        Swal.fire({
  // position: 'top-end',
  icon: 'success',
  title: 'Change successfully!',
  showConfirmButton: false,
  timer: 1500
}).then(() => {
    window.location.href = 'https://grave-stellar-answer.glitch.me/myCart';
                        });
                        
                      }
                    $(document).ready(function() {
                     
                      
                      // $('.checklist_table').sort(function(a, b) {
                      //   return parseInt($(a).find('.status').html()) - parseInt($(b).find('.status').html());
                      // }).appendTo($(".table-responsive"));
                      
                 
                      
                      
                      $("[name='list_id']").each(function(){
                      // console.log($(this).parent().find('.status').html());
                        switch($(this).parent().find('.status').html()) {
                          case "1":
                            $(this).attr('class', 'startedTask');
                            $(this).find('.change_status').html('Complete');
                            break;
                          case "2":
                            $(this).attr('class', 'assignedTask');
                            $(this).find('.change_status').html('Start');
                            break;
                          case "3":
                            $(this).attr('class', 'finishedTask');
                            $(this).find('.change_status').html('Not yet started');
                            break;
                            
                        }
                      });
                      
                      $("[name='description']").each(function(){
                      // console.log($(this).parent().find('.status').html());
                        if (!$("[name='"+$(this).html()+"']").length){
                          
                          let newDiv = document.createElement("div");
                          newDiv.setAttribute("name", $(this).html()); 
                          newDiv.setAttribute("class", "classification"); 
                          
                          let tableDiv = document.createElement("div");
                          tableDiv.setAttribute("class", "tableDiv");
                          tableDiv.setAttribute("name", "0");
                          tableDiv.setAttribute("data-number", "0");
                          
                          // let tableSpan = document.createElement("span");
                          // tableSpan.append($(this).html());
                          tableDiv.append($(this).html());
                          // tableDiv.append(tableSpan);
                          newDiv.append(tableDiv);
                          document.body.appendChild(newDiv);
                        }
                        
                      });
       
                      
                      $(".checklist_table").each(function(){
                        var thisClass = $("[name='"+$(this).find("[name='description']").html()+"']").find(".tableDiv");
                        // if ($("[name='"+$(this).find("[name='description']").html()+"']").html() == $(this).find("[name='description']").html()){
                        // if (thisClass.find("span").html() == $(this).find("[name='description']").html()){
                        if (thisClass.html() == $(this).find("[name='description']").html()){
                          var x = $(this).remove();
                          thisClass.parent().append(x);
                          
                          if ($(this).find("[name='description']").parent().parent().find(".status").html() == '3') {
                            
                            var number = parseInt(thisClass.attr('data-number'))+ 1;
                            thisClass.attr("data-number", number);
                          }
                          var total = parseInt(thisClass.attr('name'))+ 1;
                          thisClass.attr("name", total);
                        }
                        
                      });
                      
                      $(".tableDiv").each(function(){
                        
                        var width = (parseInt($(this).attr('data-number')) / parseInt($(this).attr('name'))) * 100;
                        $(this).css('width', width + "%");
                        
                        
                      });
                      
                      
                         //   $('.checklist_table').each(function(a, b) {
                    //     if ($(this).find("[name='description']").parent().parent().find(".status").html() == '3') {
                    //       $(this).setAttribute("order", "1");
                    // }
                    //   });
                      
                      
                      
                      
                      $("#checklist_table td").hide();
                      
                      $(".tableDiv").click(function() {
                         // alert(1);
                        // $(this).parent().parent().find('td').toggle();
                        //   $("[name='list_id']").find('td').show();
                        //   $(this).parent().parent().find('.status').hide();
                        
                        // $(this).parent().find("#checklist_table td tr:not([name='list_id'])").hide();//这里td不隐藏
                        
                        
                        
                        $(this).parent().find("[name='list_id']").find('td').toggle();
                        

                        });
                      
                      
                        // $("#checklist_table td").hide();
                        // $("[name='list_id']").find('td').show();
                       $(".list_id_button").click(function() {
                         // alert(1);
                        $(this).parent().parent().find('td').toggle();
                          $(this).parent().parent().find("[name='list_id']").find('td').show();
                          $(this).parent().parent().find('.status').hide();

                        });
                      
                      
                      
                      
                      
                    });
                </script>



</body>


</html>